

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="孙禄毅">
  <meta name="keywords" content="">
  
    <meta name="description" content="前言 感谢开源项目gin-vue-admin，以及1010工作室的视频教程  一、创建GORM里的创建(Create方法)，也就是数据库插入语句(Insert语句)，可以创建单条或者多条，指定字段创建等 1、Create方法1）创建单条记录1234567user :&#x3D; User&amp;#123;Name: &quot;linzy&quot;, Age: 23, Birthday: time.Now()&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Gorm学习（二）基础：CRUD接口(数据库增删改查操作)">
<meta property="og:url" content="https://gopherlinzy.github.io/2022/10/11/gorm_CRUD/index.html">
<meta property="og:site_name" content="linzy">
<meta property="og:description" content="前言 感谢开源项目gin-vue-admin，以及1010工作室的视频教程  一、创建GORM里的创建(Create方法)，也就是数据库插入语句(Insert语句)，可以创建单条或者多条，指定字段创建等 1、Create方法1）创建单条记录1234567user :&#x3D; User&amp;#123;Name: &quot;linzy&quot;, Age: 23, Birthday: time.Now()&amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gopherlinzy.github.io/img/gorm.jpg">
<meta property="article:published_time" content="2022-10-11T13:30:25.000Z">
<meta property="article:modified_time" content="2022-10-11T14:01:49.937Z">
<meta property="article:author" content="孙禄毅">
<meta property="article:tag" content="学习">
<meta property="article:tag" content="go">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="Gorm">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://gopherlinzy.github.io/img/gorm.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Gorm学习（二）基础：CRUD接口(数据库增删改查操作) - linzy</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gopherlinzy.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>LinzyBlog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/pkg11.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Gorm学习（二）基础：CRUD接口(数据库增删改查操作)"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-10-11 21:30" pubdate>
          2022年10月11日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          27k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          226 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Gorm学习（二）基础：CRUD接口(数据库增删改查操作)</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：6 个月前
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>感谢开源项目<a target="_blank" rel="noopener" href="https://www.gin-vue-admin.com/">gin-vue-admin</a>，以及<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12i4y1x7AG?spm_id_from=333.999.0.0">1010工作室的视频教程</a></p>
</blockquote>
<h1 id="一、创建"><a href="#一、创建" class="headerlink" title="一、创建"></a>一、创建</h1><p>GORM里的创建(Create方法)，也就是数据库插入语句(Insert语句)，可以创建单条或者多条，指定字段创建等</p>
<h2 id="1、Create方法"><a href="#1、Create方法" class="headerlink" title="1、Create方法"></a>1、Create方法</h2><h3 id="1）创建单条记录"><a href="#1）创建单条记录" class="headerlink" title="1）创建单条记录"></a>1）创建单条记录</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">user := User&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Age: <span class="hljs-number">23</span>, Birthday: time.Now()&#125;<br><br>result := db.Create(&amp;user) <span class="hljs-comment">// 通过数据的指针来创建</span><br><br>user.ID             <span class="hljs-comment">// 返回插入数据的主键</span><br>result.Error        <span class="hljs-comment">// 返回 error</span><br>result.RowsAffected <span class="hljs-comment">// 返回插入记录的条数</span><br></code></pre></td></tr></table></figure>
<h3 id="2）创建多条记录"><a href="#2）创建多条记录" class="headerlink" title="2）创建多条记录"></a>2）创建多条记录</h3><p>要有效地插入大量记录，需要将一个 <strong>slice</strong> 切片传递给 <strong>Create</strong> 方法。 将切片数据传递给 Create 方法，GORM 将生成一个单一的 SQL 语句来插入所有数据，并回填主键的值，钩子方法也会被调用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> users = []User&#123;&#123;Name: <span class="hljs-string">&quot;linzy1&quot;</span>&#125;, &#123;Name: <span class="hljs-string">&quot;linzy2&quot;</span>&#125;, &#123;Name: <span class="hljs-string">&quot;linzy3&quot;</span>&#125;&#125;<br>db.Create(&amp;users)<br><br><span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> users &#123;<br>	user.ID <span class="hljs-comment">// 1,2,3</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3）指定字段创建记录"><a href="#3）指定字段创建记录" class="headerlink" title="3）指定字段创建记录"></a>3）指定字段创建记录</h3><ul>
<li>用 <strong>Select</strong> 方法指定需要创建的字段</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Select(<span class="hljs-string">&quot;Name&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>, <span class="hljs-string">&quot;CreatedAt&quot;</span>).Create(&amp;user)<br><span class="hljs-comment">// INSERT INTO `users` (`name`,`age`,`created_at`) VALUES (&quot;linzy&quot;, 23, &quot;2022-07-08 11:05:21.775&quot;)</span><br></code></pre></td></tr></table></figure>
<ul>
<li>用 Omit 方法会更新未给出的字段创建记录。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Omit(<span class="hljs-string">&quot;Name&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>, <span class="hljs-string">&quot;CreatedAt&quot;</span>).Create(&amp;user)<br><span class="hljs-comment">// INSERT INTO `users` (`birthday`,`updated_at`) VALUES (&quot;2022-07-04 00:00:00.000&quot;, &quot;2022-07-08 11:05:21.775&quot;)</span><br></code></pre></td></tr></table></figure>

<h2 id="2、CreateInBatches"><a href="#2、CreateInBatches" class="headerlink" title="2、CreateInBatches"></a>2、CreateInBatches</h2><p> 使用 <strong>CreateInBatches</strong> 创建时，你还可以指定创建的数量，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">	<span class="hljs-keyword">var</span> 用户 = []User&#123;name: <span class="hljs-string">&quot;linzy_1&quot;</span>&#125;, ...., &#123;Name: <span class="hljs-string">&quot;linzy_10000&quot;</span>&#125;&#125;<br><br><span class="hljs-comment">// 数量为 100</span><br>	db.CreateInBatches(用户, <span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>Upsert 和 Create With Associations 也支持批量插入</p>
</blockquote>
<h2 id="3、创建钩子"><a href="#3、创建钩子" class="headerlink" title="3、创建钩子"></a>3、创建钩子</h2><p>GORM 允许用户定义的钩子有 <strong>BeforeSave</strong>, <strong>BeforeCreate</strong>, <strong>AfterSave</strong>, <strong>AfterCreate</strong> 创建记录时将调用这些钩子方法</p>
<p>例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> BeforeCreate(tx *gorm.DB) (err <span class="hljs-type">error</span>) &#123;<br>	u.UUID = uuid.New()<br><br>    <span class="hljs-keyword">if</span> u.Role == <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>       	<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;invalid role&quot;</span>)<br>   	&#125;<br>  		<span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果您想跳过 <strong>钩子</strong> 方法，您可以使用 <strong>SkipHooks</strong> 会话模式，例如：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//SkipHooks为true表示当前方法 不执行钩子方法</span><br>DB.Session(&amp;gorm.Session&#123;SkipHooks: <span class="hljs-literal">true</span>&#125;).Create(&amp;user)<br><br>DB.Session(&amp;gorm.Session&#123;SkipHooks: <span class="hljs-literal">true</span>&#125;).Create(&amp;users)<br><br>DB.Session(&amp;gorm.Session&#123;SkipHooks: <span class="hljs-literal">true</span>&#125;).CreateInBatches(users, <span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure>
<h2 id="4、根据-Map-创建"><a href="#4、根据-Map-创建" class="headerlink" title="4、根据 Map 创建"></a>4、根据 Map 创建</h2><p>通常我们用GORM都是用<strong>结构体 struct</strong> 来创建记录，而<strong>GORM</strong> 也支持根据 <strong>map[string]interface{}</strong> 和 <strong>[]map[string]interface{}{}</strong> 创建记录，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//创建单条记录</span><br>db.Model(&amp;User&#123;&#125;).Create(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<br>	<span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>: <span class="hljs-number">23</span>,<br>&#125;)<br><br><span class="hljs-comment">//创建多条记录</span><br>db.Model(&amp;User&#123;&#125;).Create([]<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<br>	&#123;<span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;linzy_1&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>: <span class="hljs-number">23</span>&#125;,<br>	&#123;<span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;linzy_2&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>: <span class="hljs-number">66</span>&#125;,<br>	&#123;<span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;linzy_3&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>: <span class="hljs-number">88</span>&#125;,<br>&#125;)<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：根据 map 创建记录时，<strong>association</strong> (查找关联方法)不会被调用，且主键也不会自动填充</p>
</blockquote>
<h2 id="5、高级选项"><a href="#5、高级选项" class="headerlink" title="5、高级选项"></a>5、高级选项</h2><h3 id="1）关联创建"><a href="#1）关联创建" class="headerlink" title="1）关联创建"></a>1）关联创建</h3><p>创建关联数据时，如果关联值是非零值，这些关联会被 upsert，且它们的 <strong>Hook</strong> 钩子方法也会被调用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> CreditCard <span class="hljs-keyword">struct</span> &#123;<br>	gorm.Model<br>	Number <span class="hljs-type">string</span><br>	UserID <span class="hljs-type">uint</span><br>&#125;<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	gorm.Model<br>	Name       <span class="hljs-type">string</span><br>	CreditCard CreditCard <span class="hljs-comment">// 一对一的关系</span><br>&#125;<br><br>db.Create(&amp;User&#123;<br>	Name:       <span class="hljs-string">&quot;linzy&quot;</span>,<br>	CreditCard: CreditCard&#123;Number: <span class="hljs-string">&quot;123456789&quot;</span>&#125;,<br>&#125;)<br><span class="hljs-comment">// INSERT INTO `users` ...</span><br><span class="hljs-comment">// INSERT INTO `credit_cards` ...</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>您也可以通过 <strong>Select</strong>、 <strong>Omit</strong> 跳过关联保存，例如：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Omit(<span class="hljs-string">&quot;CreditCard&quot;</span>).Create(&amp;user)<br><br><span class="hljs-comment">// 跳过所有关联</span><br>db.Omit(clause.Associations).Create(&amp;user)<br></code></pre></td></tr></table></figure>
<h3 id="2）默认值"><a href="#2）默认值" class="headerlink" title="2）默认值"></a>2）默认值</h3><p>您可以通过标签 <strong>default</strong> 为字段定义默认值，如：</p>
<blockquote>
<p>插入记录到数据库时，默认值 <em>会被用于</em> 填充值为 <strong>零值</strong> 的字段</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	ID   <span class="hljs-type">int64</span><br>	Name <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;default:linzy&quot;`</span><br>	Age  <span class="hljs-type">int64</span>  <span class="hljs-string">`gorm:&quot;default:23&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>： 像 <strong>0</strong>、**’’<strong>、</strong>false** 等零值，不会将这些字段定义的默认值保存到数据库。您需要使用指针类型或 <strong>Scanner</strong>&#x2F;<strong>Valuer</strong> 来避免这个问题，例如：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	gorm.Model<br>	Name   <span class="hljs-type">string</span><br>	Age    *<span class="hljs-type">int</span>         <span class="hljs-string">`gorm:&quot;default:23&quot;`</span><br>	Active sql.NullBool <span class="hljs-string">`gorm:&quot;default:true&quot;`</span><br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>： 若要数据库有默认、虚拟 &#x2F; 生成的值，你必须为字段设置 default 标签。若要在迁移时跳过默认值定义，你可以使用 default:(-)，例如：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	ID        <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;default:uuid_generate_v3()&quot;`</span> <span class="hljs-comment">// 数据库函数</span><br>	FirstName <span class="hljs-type">string</span><br>	LastName  <span class="hljs-type">string</span><br>	Age       <span class="hljs-type">uint8</span><br>	FullName  <span class="hljs-type">string</span> <span class="hljs-string">`gorm:&quot;-&gt;;type:GENERATED ALWAYS AS (concat(firstname,&#x27; &#x27;,lastname));default:(-);`</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="二、查询"><a href="#二、查询" class="headerlink" title="二、查询"></a>二、查询</h1><p>GORM里的查询(Find方法)，也就是数据库查询语句(Select语句)，可以查询所有数据、查询指定条件数据，查询首条数据，查询最后一条数据</p>
<h2 id="1、查询单条数据"><a href="#1、查询单条数据" class="headerlink" title="1、查询单条数据"></a>1、查询单条数据</h2><p>GORM 提供了 <strong>First</strong>、<strong>Take</strong>、<strong>Last</strong> 方法，以便从数据库中检索单个对象。当查询数据库时它添加了 <strong>LIMIT 1</strong> 条件，且没有找到记录时，它会返回 <strong>ErrRecordNotFound</strong> 错误</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 获取第一条记录（主键升序）</span><br>db.First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users ORDER BY id LIMIT 1;</span><br><br><span class="hljs-comment">// 获取一条记录，没有指定排序字段</span><br>db.Take(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users LIMIT 1;</span><br><br><span class="hljs-comment">// 获取最后一条记录（主键降序）</span><br>db.Last(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users ORDER BY id DESC LIMIT 1;</span><br><br>result := db.First(&amp;user)<br>result.RowsAffected <span class="hljs-comment">// 返回找到的记录数</span><br>result.Error        <span class="hljs-comment">// returns error</span><br><br><span class="hljs-comment">// 检查 ErrRecordNotFound 错误</span><br>errors.Is(result.Error, gorm.ErrRecordNotFound)<br></code></pre></td></tr></table></figure>
<ul>
<li><code>First、Last 方法会根据主键查找到第一个、最后一个记录， 它仅在通过结构体 struct 或提供 model 值进行查询时才起作用。</code> 如果 model 类型没有定义主键，则按第一个字段排序，例如：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> user User<br><span class="hljs-comment">// 可以</span><br>db.First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM `users` ORDER BY `users`.`id` LIMIT 1</span><br><br><span class="hljs-comment">// 可以</span><br>result := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;&#125;<br>db.Model(&amp;User&#123;&#125;).First(&amp;result)<br><span class="hljs-comment">// SELECT * FROM `users` ORDER BY `users`.`id` LIMIT 1</span><br><br><span class="hljs-comment">// 不行</span><br>result := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;&#125;<br>db.Table(<span class="hljs-string">&quot;users&quot;</span>).First(&amp;result)<br><br><span class="hljs-comment">// 但可以配合 Take 使用</span><br>result := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;&#125;<br>db.Table(<span class="hljs-string">&quot;users&quot;</span>).Take(&amp;result)<br><br><span class="hljs-comment">// 根据第一个字段排序</span><br><span class="hljs-keyword">type</span> Language <span class="hljs-keyword">struct</span> &#123;<br>	Code <span class="hljs-type">string</span><br>	Name <span class="hljs-type">string</span><br>&#125;<br>db.First(&amp;Language&#123;&#125;)<br><span class="hljs-comment">// SELECT * FROM `languages` ORDER BY `languages`.`code` LIMIT 1</span><br></code></pre></td></tr></table></figure>
<h2 id="2、根据主键查询"><a href="#2、根据主键查询" class="headerlink" title="2、根据主键查询"></a>2、根据主键查询</h2><p>您可以使用 <strong>内联条件</strong> 来检索对象。 传入字符串参数时注意避免 SQL 注入问题</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">db.First(&amp;user, <span class="hljs-number">10</span>)<br><span class="hljs-comment">// SELECT * FROM users WHERE id = 10;</span><br><br>db.First(&amp;user, <span class="hljs-string">&quot;10&quot;</span>)<br><span class="hljs-comment">// SELECT * FROM users WHERE id = 10;</span><br><br>db.Find(&amp;users, []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;)<br><span class="hljs-comment">// SELECT * FROM users WHERE id IN (1,2,3);</span><br></code></pre></td></tr></table></figure>
<h2 id="3、查询全部数据"><a href="#3、查询全部数据" class="headerlink" title="3、查询全部数据"></a>3、查询全部数据</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 获取全部记录</span><br>result := db.Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users;</span><br><br>result.RowsAffected <span class="hljs-comment">// 返回找到的记录数，相当于 `len(users)`</span><br>result.Error        <span class="hljs-comment">// returns error</span><br></code></pre></td></tr></table></figure>
<h2 id="4、条件查询"><a href="#4、条件查询" class="headerlink" title="4、条件查询"></a>4、条件查询</h2><p>条件查询即查询满足条件的所有数据，GORM框架给用户提供了 String条件 、Struct &amp; Map 条件、内联条件 、Not 条件以及 Or 条件查询方式</p>
<h3 id="1）String条件"><a href="#1）String条件" class="headerlink" title="1）String条件"></a>1）String条件</h3><p>通过Where方法，对String里的？进行填充，来完成条件查询</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 获取第一条匹配的记录</span><br>db.Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &#x27;linzy&#x27; ORDER BY id LIMIT 1;</span><br><br><span class="hljs-comment">// 获取全部匹配的记录</span><br>db.Where(<span class="hljs-string">&quot;name &lt;&gt; ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name &lt;&gt; &#x27;linzy&#x27;;</span><br><br><span class="hljs-comment">// IN</span><br>db.Where(<span class="hljs-string">&quot;name IN ?&quot;</span>, []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;linzy2&quot;</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name IN (&#x27;linzy&#x27;,&#x27;linzy2&#x27;);</span><br><br><span class="hljs-comment">// LIKE</span><br>db.Where(<span class="hljs-string">&quot;name LIKE ?&quot;</span>, <span class="hljs-string">&quot;%in%&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name LIKE &#x27;%in%&#x27;;</span><br><br><span class="hljs-comment">// AND</span><br>db.Where(<span class="hljs-string">&quot;name = ? AND age &gt;= ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;22&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &#x27;linzy&#x27; AND age &gt;= 22;</span><br><br><span class="hljs-comment">// Time</span><br>db.Where(<span class="hljs-string">&quot;updated_at &gt; ?&quot;</span>, lastWeek).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE updated_at &gt; &#x27;2000-01-01 00:00:00&#x27;;</span><br><br><span class="hljs-comment">// BETWEEN</span><br>db.Where(<span class="hljs-string">&quot;created_at BETWEEN ? AND ?&quot;</span>, lastWeek, today).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE created_at BETWEEN &#x27;2000-01-01 00:00:00&#x27; AND &#x27;2000-01-08 00:00:00&#x27;;</span><br></code></pre></td></tr></table></figure>
<h3 id="2）Struct-amp-Map-条件"><a href="#2）Struct-amp-Map-条件" class="headerlink" title="2）Struct &amp; Map 条件"></a>2）Struct &amp; Map 条件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Struct</span><br>db.Where(&amp;User&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Age: <span class="hljs-number">20</span>&#125;).First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &quot;linzy&quot; AND age = 20 ORDER BY id LIMIT 1;</span><br><br><span class="hljs-comment">// Map</span><br>db.Where(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">20</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &quot;linzy&quot; AND age = 20;</span><br><br><span class="hljs-comment">// 主键切片条件</span><br>db.Where([]<span class="hljs-type">int64</span>&#123;<span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE id IN (20, 21, 22);</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>： 当使用结构作为条件查询时，GORM 只会查询非零值字段。这意味着如果您的字段值为 <strong>0</strong>、**’’<strong>、</strong>false** 或其他 <strong>零值</strong>，该字段不会被用于构建查询条件，例如：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Where(&amp;User&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Age: <span class="hljs-number">0</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &quot;linzy&quot;;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>您可以使用 map 来构建查询条件，例如：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Where(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;Name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>: <span class="hljs-number">0</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &quot;linzy&quot; AND age = 0;</span><br></code></pre></td></tr></table></figure>

<h3 id="3）内联条件"><a href="#3）内联条件" class="headerlink" title="3）内联条件"></a>3）内联条件</h3><p>用法跟 <strong>Where</strong> 方法一样</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// SELECT * FROM users WHERE id = 23;</span><br><span class="hljs-comment">// 根据主键获取记录，如果是非整型主键</span><br>db.First(&amp;user, <span class="hljs-string">&quot;id = ?&quot;</span>, <span class="hljs-string">&quot;string_primary_key&quot;</span>)<br><span class="hljs-comment">// SELECT * FROM users WHERE id = &#x27;string_primary_key&#x27;;</span><br><br><span class="hljs-comment">// Plain SQL</span><br>db.Find(&amp;user, <span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &quot;linzy&quot;;</span><br><br>db.Find(&amp;users, <span class="hljs-string">&quot;name &lt;&gt; ? AND age &gt; ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-number">20</span>)<br><span class="hljs-comment">// SELECT * FROM users WHERE name &lt;&gt; &quot;linzy&quot; AND age &gt; 20;</span><br><br><span class="hljs-comment">// Struct</span><br>db.Find(&amp;users, User&#123;Age: <span class="hljs-number">20</span>&#125;)<br><span class="hljs-comment">// SELECT * FROM users WHERE age = 20;</span><br><br><span class="hljs-comment">// Map</span><br>db.Find(&amp;users, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">20</span>&#125;)<br><span class="hljs-comment">// SELECT * FROM users WHERE age = 20;</span><br></code></pre></td></tr></table></figure>
<h3 id="4）Not-条件"><a href="#4）Not-条件" class="headerlink" title="4）Not 条件"></a>4）Not 条件</h3><p>Not在sql语句中是一个逻辑运算符，取反的用处，<strong>真为假</strong>，<strong>假为真</strong>，语句用法跟 <strong>Where</strong> 方法一样</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Not(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE NOT name = &quot;linzy&quot; ORDER BY id LIMIT 1;</span><br><br><span class="hljs-comment">// Not In</span><br>db.Not(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;linzy 2&quot;</span>&#125;&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name NOT IN (&quot;linzy&quot;, &quot;linzy 2&quot;);</span><br><br><span class="hljs-comment">// Struct</span><br>db.Not(User&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Age: <span class="hljs-number">18</span>&#125;).First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE name &lt;&gt; &quot;linzy&quot; AND age &lt;&gt; 18 ORDER BY id LIMIT 1;</span><br><br><span class="hljs-comment">// 不在主键切片中的记录</span><br>db.Not([]<span class="hljs-type">int64</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;).First(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE id NOT IN (1,2,3) ORDER BY id LIMIT 1;</span><br></code></pre></td></tr></table></figure>
<h3 id="5）Or条件"><a href="#5）Or条件" class="headerlink" title="5）Or条件"></a>5）Or条件</h3><p>在 <strong>Where 方法</strong>和 <strong>内联条件</strong> 存在多个条件的时候都是用AND联系，表示条件都必须满足的数据，那我们如果只需要满足其中一种条件呢，那就需要 <strong>Or条件</strong> 了，语句用法跟 <strong>Where</strong> 方法一样</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Where(<span class="hljs-string">&quot;role = ?&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>).Or(<span class="hljs-string">&quot;role = ?&quot;</span>, <span class="hljs-string">&quot;super_admin&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE role = &#x27;admin&#x27; OR role = &#x27;super_admin&#x27;;</span><br><br><span class="hljs-comment">// Struct</span><br>db.Where(<span class="hljs-string">&quot;name = &#x27;linzy&#x27;&quot;</span>).Or(User&#123;Name: <span class="hljs-string">&quot;linzy 2&quot;</span>, Age: <span class="hljs-number">18</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &#x27;linzy&#x27; OR (name = &#x27;linzy 2&#x27; AND age = 18);</span><br><br><span class="hljs-comment">// Map</span><br>db.Where(<span class="hljs-string">&quot;name = &#x27;linzy&#x27;&quot;</span>).Or(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy 2&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE name = &#x27;linzy&#x27; OR (name = &#x27;linzy 2&#x27; AND age = 18);</span><br></code></pre></td></tr></table></figure>
<h2 id="5、选择特定字段"><a href="#5、选择特定字段" class="headerlink" title="5、选择特定字段"></a>5、选择特定字段</h2><h3 id="1）Select"><a href="#1）Select" class="headerlink" title="1）Select"></a>1）Select</h3><p>选择您想从数据库中检索的字段，默认情况下会选择全部字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Select(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT name, age FROM users;</span><br><br>db.Select([]<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>&#125;).Find(&amp;users)<br><span class="hljs-comment">// SELECT name, age FROM users;</span><br><br>db.Table(<span class="hljs-string">&quot;users&quot;</span>).Select(<span class="hljs-string">&quot;COALESCE(age,?)&quot;</span>, <span class="hljs-number">42</span>).Rows()<br><span class="hljs-comment">// SELECT COALESCE(age,&#x27;42&#x27;) FROM users;</span><br></code></pre></td></tr></table></figure>

<h3 id="2）结构体智能选择字段"><a href="#2）结构体智能选择字段" class="headerlink" title="2）结构体智能选择字段"></a>2）结构体智能选择字段</h3><p>GORM 允许通过 <code>Select </code>方法选择特定的字段，如果在应用程序中经常使用Select获取特定的字段，你也可以定义一个较小的结构体，以实现调用 API 时自动选择特定的字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>  ID     <span class="hljs-type">uint</span><br>  Name   <span class="hljs-type">string</span><br>  Age    <span class="hljs-type">int</span><br>  Gender <span class="hljs-type">string</span><br>  <span class="hljs-comment">// 假设后面还有几百个字段...</span><br>&#125;<br><br><span class="hljs-keyword">type</span> APIUser <span class="hljs-keyword">struct</span> &#123;<br>  ID   <span class="hljs-type">uint</span><br>  Name <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-comment">// 查询时会自动选择 `id`, `name` 字段</span><br>db.Model(&amp;User&#123;&#125;).Limit(<span class="hljs-number">10</span>).Find(&amp;APIUser&#123;&#125;)<br><span class="hljs-comment">// SELECT `id`, `name` FROM `users` LIMIT 10</span><br></code></pre></td></tr></table></figure>

<h2 id="6、Order排序"><a href="#6、Order排序" class="headerlink" title="6、Order排序"></a>6、Order排序</h2><p>指定从数据库检索记录时的排序方式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Order(<span class="hljs-string">&quot;age desc, name&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users ORDER BY age desc, name;</span><br><br><span class="hljs-comment">// 多个 order</span><br>db.Order(<span class="hljs-string">&quot;age desc&quot;</span>).Order(<span class="hljs-string">&quot;name&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users ORDER BY age desc, name;</span><br><br>db.Clauses(clause.OrderBy&#123;<br>	Expression: clause.Expr&#123;SQL: <span class="hljs-string">&quot;FIELD(id,?)&quot;</span>, Vars: []<span class="hljs-keyword">interface</span>&#123;&#125;&#123;[]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;&#125;, WithoutParentheses: <span class="hljs-literal">true</span>&#125;,<br>&#125;).Find(&amp;User&#123;&#125;)<br><span class="hljs-comment">// SELECT * FROM users ORDER BY FIELD(id,1,2,3)</span><br></code></pre></td></tr></table></figure>
<h2 id="7、Limit-amp-Offset"><a href="#7、Limit-amp-Offset" class="headerlink" title="7、Limit &amp; Offset"></a>7、Limit &amp; Offset</h2><ul>
<li><strong>Limit</strong> 指定获取记录的最大数量 </li>
<li><strong>Offset</strong> 指定在开始返回记录之前要跳过的记录数量</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Limit(<span class="hljs-number">3</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users LIMIT 3;</span><br><br><span class="hljs-comment">// 通过 -1 消除 Limit 条件</span><br>db.Limit(<span class="hljs-number">10</span>).Find(&amp;users1).Limit(<span class="hljs-number">-1</span>).Find(&amp;users2)<br><span class="hljs-comment">// SELECT * FROM users LIMIT 10; (users1)</span><br><span class="hljs-comment">// SELECT * FROM users; (users2)</span><br><br>db.Offset(<span class="hljs-number">3</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users OFFSET 3;</span><br><br>db.Limit(<span class="hljs-number">10</span>).Offset(<span class="hljs-number">5</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users OFFSET 5 LIMIT 10;</span><br><br><span class="hljs-comment">// 通过 -1 消除 Offset 条件</span><br>db.Offset(<span class="hljs-number">10</span>).Find(&amp;users1).Offset(<span class="hljs-number">-1</span>).Find(&amp;users2)<br><span class="hljs-comment">// SELECT * FROM users OFFSET 10; (users1)</span><br><span class="hljs-comment">// SELECT * FROM users; (users2)</span><br></code></pre></td></tr></table></figure>
<h2 id="8、Group-amp-Having"><a href="#8、Group-amp-Having" class="headerlink" title="8、Group &amp; Having"></a>8、Group &amp; Having</h2><ul>
<li><strong>Group</strong> 指定字段进行分组</li>
<li><strong>Having</strong> 指定字段分组后的条件查询</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> result <span class="hljs-keyword">struct</span> &#123;<br>	Date  time.Time<br>	Total <span class="hljs-type">int</span><br>&#125;<br>	  <br>	db.Model(&amp;User&#123;&#125;).Select(<span class="hljs-string">&quot;name, sum(age) as total&quot;</span>).Where(<span class="hljs-string">&quot;name LIKE ?&quot;</span>, <span class="hljs-string">&quot;group%&quot;</span>).Group(<span class="hljs-string">&quot;name&quot;</span>).First(&amp;result)<br>	<span class="hljs-comment">// SELECT name, sum(age) as total FROM `users` WHERE name LIKE &quot;group%&quot; GROUP BY `name`</span><br>	  <br>	db.Model(&amp;User&#123;&#125;).Select(<span class="hljs-string">&quot;name, sum(age) as total&quot;</span>).Group(<span class="hljs-string">&quot;name&quot;</span>).Having(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;group&quot;</span>).Find(&amp;result)<br>	<span class="hljs-comment">// SELECT name, sum(age) as total FROM `users` GROUP BY `name` HAVING name = &quot;group&quot;</span><br>	  <br>	rows, err := db.Table(<span class="hljs-string">&quot;orders&quot;</span>).Select(<span class="hljs-string">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class="hljs-string">&quot;date(created_at)&quot;</span>).Rows()<br>	<span class="hljs-keyword">for</span> rows.Next() &#123;<br>		...<br>	 &#125;<br>	  <br>	rows, err := db.Table(<span class="hljs-string">&quot;orders&quot;</span>).Select(<span class="hljs-string">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class="hljs-string">&quot;date(created_at)&quot;</span>).Having(<span class="hljs-string">&quot;sum(amount) &gt; ?&quot;</span>, <span class="hljs-number">100</span>).Rows()<br>	<span class="hljs-keyword">for</span> rows.Next() &#123;<br>		...<br>	&#125;<br>	  <br><span class="hljs-keyword">type</span> Result <span class="hljs-keyword">struct</span> &#123;<br>	Date  time.Time<br>	Total <span class="hljs-type">int64</span><br>&#125;<br>	db.Table(<span class="hljs-string">&quot;orders&quot;</span>).Select(<span class="hljs-string">&quot;date(created_at) as date, sum(amount) as total&quot;</span>).Group(<span class="hljs-string">&quot;date(created_at)&quot;</span>).Having(<span class="hljs-string">&quot;sum(amount) &gt; ?&quot;</span>, <span class="hljs-number">100</span>).Scan(&amp;results)<br></code></pre></td></tr></table></figure>
<h2 id="9、Distinct去重"><a href="#9、Distinct去重" class="headerlink" title="9、Distinct去重"></a>9、Distinct去重</h2><p>从模型中选择不相同的值，简而言之，把选定的字段里重复数据去掉，只留下一条</p>
<blockquote>
<p>Distinct 也可以配合 <strong>Pluck</strong>, <strong>Count</strong> 使用</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Distinct(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>).Order(<span class="hljs-string">&quot;name, age desc&quot;</span>).Find(&amp;results)<br></code></pre></td></tr></table></figure>

<h2 id="10、Joins连接"><a href="#10、Joins连接" class="headerlink" title="10、Joins连接"></a>10、Joins连接</h2><p>数据空的连接操作，有左连接(left join)，右连接(right join)，全连接(outer join)、内连接(inner join)，指定 Joins 条件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> result <span class="hljs-keyword">struct</span> &#123;<br>	Name  <span class="hljs-type">string</span><br>	Email <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">//左连接</span><br>	db.Model(&amp;User&#123;&#125;).Select(<span class="hljs-string">&quot;users.name, emails.email&quot;</span>).Joins(<span class="hljs-string">&quot;left join emails on emails.user_id = users.id&quot;</span>).Scan(&amp;result&#123;&#125;)<br>	<span class="hljs-comment">// SELECT users.name, emails.email FROM `users` left join emails on emails.user_id = users.id</span><br>	<br>	rows, err := db.Table(<span class="hljs-string">&quot;users&quot;</span>).Select(<span class="hljs-string">&quot;users.name, emails.email&quot;</span>).Joins(<span class="hljs-string">&quot;left join emails on emails.user_id = users.id&quot;</span>).Rows()<br>	<span class="hljs-keyword">for</span> rows.Next() &#123;<br>	  ...<br>	&#125;<br>	<br>	db.Table(<span class="hljs-string">&quot;users&quot;</span>).Select(<span class="hljs-string">&quot;users.name, emails.email&quot;</span>).Joins(<span class="hljs-string">&quot;left join emails on emails.user_id = users.id&quot;</span>).Scan(&amp;results)<br>	<br>	<span class="hljs-comment">// 带参数的多表连接</span><br>	db.Joins(<span class="hljs-string">&quot;JOIN emails ON emails.user_id = users.id AND emails.email = ?&quot;</span>, <span class="hljs-string">&quot;linzy@example.org&quot;</span>).Joins(<span class="hljs-string">&quot;JOIN credit_cards ON credit_cards.user_id = users.id&quot;</span>).Where(<span class="hljs-string">&quot;credit_cards.number = ?&quot;</span>, <span class="hljs-string">&quot;411111111111&quot;</span>).Find(&amp;user)<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="11、Joins-预加载"><a href="#11、Joins-预加载" class="headerlink" title="11、Joins 预加载"></a>11、Joins 预加载</h2><p>您可以使用 <strong>Joins</strong> 实现单条 SQL 预加载关联记录，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Joins(<span class="hljs-string">&quot;Company&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT `users`.`id`,`users`.`name`,`users`.`age`,`Company`.`id` AS `Company__id`,`Company`.`name` AS `Company__name` FROM `users` LEFT JOIN `companies` AS `Company` ON `users`.`company_id` = `Company`.`id`;</span><br></code></pre></td></tr></table></figure>
<h2 id="12、Scan"><a href="#12、Scan" class="headerlink" title="12、Scan"></a>12、Scan</h2><p>Scan 结果存储于结构体 <strong>struct</strong>，用法与 Find 类似</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Result <span class="hljs-keyword">struct</span> &#123;<br>  Name <span class="hljs-type">string</span><br>  Age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-keyword">var</span> result Result<br>	db.Table(<span class="hljs-string">&quot;users&quot;</span>).Select(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>).Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;Antonio&quot;</span>).Scan(&amp;result)<br><br>	<span class="hljs-comment">// 原生 SQL</span><br>	db.Raw(<span class="hljs-string">&quot;SELECT name, age FROM users WHERE name = ?&quot;</span>, <span class="hljs-string">&quot;Antonio&quot;</span>).Scan(&amp;result)<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="三、更新"><a href="#三、更新" class="headerlink" title="三、更新"></a>三、更新</h1><p>GORM里的更新(Update方法)，也就是数据库更新语句(Update语句)，可以更新单列、更新多列、更新选定列</p>
<h2 id="1、更新单列"><a href="#1、更新单列" class="headerlink" title="1、更新单列"></a>1、更新单列</h2><p>当使用 <strong>Update</strong> 更新单个列时，你需要指定条件，否则会返回 <strong>ErrMissingWhereClause</strong> 错误。当使用了 <strong>Model</strong> 方法，且该对象主键有值，该值会被用于构建条件，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 条件更新</span><br>db.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;active = ?&quot;</span>, <span class="hljs-literal">true</span>).Update(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE active=true;</span><br><br><span class="hljs-comment">// User 的 ID 是 `111`</span><br>db.Model(&amp;user).Update(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span><br><br><span class="hljs-comment">// 根据条件和 model 的值进行更新</span><br>db.Model(&amp;user).Where(<span class="hljs-string">&quot;active = ?&quot;</span>, <span class="hljs-literal">true</span>).Update(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111 AND active=true;</span><br></code></pre></td></tr></table></figure>
<h2 id="2、更新多列"><a href="#2、更新多列" class="headerlink" title="2、更新多列"></a>2、更新多列</h2><p><strong>Updates</strong> 方法支持 <strong>struct</strong> 和 <strong>map[string]interface{}</strong> 参数。当使用 <strong>struct</strong> 更新时，默认情况下，GORM 只会更新非零值的字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 根据 `struct` 更新属性，只会更新非零值的字段</span><br>db.Model(&amp;user).Updates(User&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Age: <span class="hljs-number">18</span>, Active: <span class="hljs-literal">false</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, age=18, updated_at = &#x27;2013-11-17 21:34:10&#x27; WHERE id = 111;</span><br><br><span class="hljs-comment">// 根据 `map` 更新属性</span><br>db.Model(&amp;user).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>, <span class="hljs-string">&quot;actived&quot;</span>: <span class="hljs-literal">false</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, age=18, actived=false, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：当通过 <strong>struct</strong> 更新时，GORM 只会更新<strong>非零字段</strong>。 如果您想确保指定字段被更新，你应该使用 <strong>Select</strong> 更新选定字段，或使用 <strong>map</strong> 来完成更新操作</p>
</blockquote>
<h2 id="3、更新选定字段"><a href="#3、更新选定字段" class="headerlink" title="3、更新选定字段"></a>3、更新选定字段</h2><p>如果您想要在更新时选定、忽略某些字段，您可以使用 <strong>Select</strong>、<strong>Omit</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Select 和 Map</span><br><span class="hljs-comment">// User&#x27;s ID is `111`:</span><br>db.Model(&amp;user).Select(<span class="hljs-string">&quot;name&quot;</span>).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>, <span class="hljs-string">&quot;actived&quot;</span>: <span class="hljs-literal">false</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27; WHERE id=111;</span><br><br>db.Model(&amp;user).Omit(<span class="hljs-string">&quot;name&quot;</span>).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>, <span class="hljs-string">&quot;actived&quot;</span>: <span class="hljs-literal">false</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET age=18, actived=false, updated_at=&#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span><br><br><span class="hljs-comment">// Select 和 Struct （可以选中更新零值字段）</span><br>db.Model(&amp;result).Select(<span class="hljs-string">&quot;Name&quot;</span>, <span class="hljs-string">&quot;Age&quot;</span>).Updates(User&#123;Name: <span class="hljs-string">&quot;new_name&quot;</span>, Age: <span class="hljs-number">0</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;new_name&#x27;, age=0 WHERE id=111;</span><br></code></pre></td></tr></table></figure>
<h2 id="4、保存所有字段"><a href="#4、保存所有字段" class="headerlink" title="4、保存所有字段"></a>4、保存所有字段</h2><p><strong>Save</strong> 会保存所有的字段，即使字段是零值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">db.First(&amp;user)<br><br>	user.Name = <span class="hljs-string">&quot;linzy 2&quot;</span><br>	user.Age = <span class="hljs-number">100</span><br>	db.Save(&amp;user)<br>	<span class="hljs-comment">// UPDATE users SET name=&#x27;linzy 2&#x27;, age=100, birthday=&#x27;2016-01-01&#x27;, updated_at = &#x27;2013-11-17 21:34:10&#x27; WHERE id=111;</span><br></code></pre></td></tr></table></figure>
<h2 id="5、更新-Hook"><a href="#5、更新-Hook" class="headerlink" title="5、更新 Hook"></a>5、更新 Hook</h2><p>对于更新操作，GORM 支持 <strong>BeforeSave</strong>、<strong>BeforeUpdate</strong>、<strong>AfterSave</strong>、<strong>AfterUpdate</strong> 钩子，这些方法将在更新记录时被调用<br>例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> BeforeUpdate(tx *gorm.DB) (err <span class="hljs-type">error</span>) &#123;<br>	<span class="hljs-keyword">if</span> u.Role == <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>		<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;admin user not allowed to update&quot;</span>)<br>	&#125;<br>	<span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="6、批量更新"><a href="#6、批量更新" class="headerlink" title="6、批量更新"></a>6、批量更新</h2><p>如果您尚未通过 <strong>Model</strong> 指定记录的主键，则 GORM 会执行批量更新</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 根据 struct 更新</span><br>db.Model(User&#123;&#125;).Where(<span class="hljs-string">&quot;role = ?&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>).Updates(User&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Age: <span class="hljs-number">18</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, age=18 WHERE role = &#x27;admin;</span><br><br><span class="hljs-comment">// 根据 map 更新</span><br>db.Table(<span class="hljs-string">&quot;users&quot;</span>).Where(<span class="hljs-string">&quot;id IN ?&quot;</span>, []<span class="hljs-type">int</span>&#123;<span class="hljs-number">10</span>, <span class="hljs-number">11</span>&#125;).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;linzy&#x27;, age=18 WHERE id IN (10, 11);</span><br></code></pre></td></tr></table></figure>
<h3 id="1）阻止全局更新"><a href="#1）阻止全局更新" class="headerlink" title="1）阻止全局更新"></a>1）阻止全局更新</h3><p>如果在没有任何条件的情况下执行批量更新，默认情况下，GORM 不会执行该操作，并返回 <strong>ErrMissingWhereClause</strong> 错误</p>
<p>对此，你必须加一些条件，或者使用原生 SQL，或者启用 <strong>AllowGlobalUpdate</strong> 模式，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Model(&amp;User&#123;&#125;).Update(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Error <span class="hljs-comment">// gorm.ErrMissingWhereClause</span><br><br>db.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;1 = 1&quot;</span>).Update(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET `name` = &quot;linzy&quot; WHERE 1=1</span><br><br>db.Exec(<span class="hljs-string">&quot;UPDATE users SET name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET name = &quot;linzy&quot;</span><br><br>db.Session(&amp;gorm.Session&#123;AllowGlobalUpdate: <span class="hljs-literal">true</span>&#125;).Model(&amp;User&#123;&#125;).Update(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET `name` = &quot;linzy&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="2）更新的记录数"><a href="#2）更新的记录数" class="headerlink" title="2）更新的记录数"></a>2）更新的记录数</h3><p>获取受更新影响的行数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 通过 `RowsAffected` 得到更新的记录数</span><br>result := db.Model(User&#123;&#125;).Where(<span class="hljs-string">&quot;role = ?&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>).Updates(User&#123;Name: <span class="hljs-string">&quot;hello&quot;</span>, Age: <span class="hljs-number">18</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;hello&#x27;, age=18 WHERE role = &#x27;admin;</span><br><br>result.RowsAffected <span class="hljs-comment">// 更新的记录数</span><br>result.Error        <span class="hljs-comment">// 更新的错误</span><br></code></pre></td></tr></table></figure>
<h2 id="7、高级选项"><a href="#7、高级选项" class="headerlink" title="7、高级选项"></a>7、高级选项</h2><h3 id="1）使用-SQL-表达式更新"><a href="#1）使用-SQL-表达式更新" class="headerlink" title="1）使用 SQL 表达式更新"></a>1）使用 SQL 表达式更新</h3><p>GORM 允许使用 SQL 表达式更新列，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// product 的 ID 是 `3`</span><br>db.Model(&amp;product).Update(<span class="hljs-string">&quot;price&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;price * ? + ?&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100</span>))<br><span class="hljs-comment">// UPDATE &quot;products&quot; SET &quot;price&quot; = price * 2 + 100, &quot;updated_at&quot; = &#x27;2013-11-17 21:34:10&#x27; WHERE &quot;id&quot; = 3;</span><br><br>db.Model(&amp;product).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;price&quot;</span>: gorm.Expr(<span class="hljs-string">&quot;price * ? + ?&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100</span>)&#125;)<br><span class="hljs-comment">// UPDATE &quot;products&quot; SET &quot;price&quot; = price * 2 + 100, &quot;updated_at&quot; = &#x27;2013-11-17 21:34:10&#x27; WHERE &quot;id&quot; = 3;</span><br><br>db.Model(&amp;product).UpdateColumn(<span class="hljs-string">&quot;quantity&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;quantity - ?&quot;</span>, <span class="hljs-number">1</span>))<br><span class="hljs-comment">// UPDATE &quot;products&quot; SET &quot;quantity&quot; = quantity - 1 WHERE &quot;id&quot; = 3;</span><br><br>db.Model(&amp;product).Where(<span class="hljs-string">&quot;quantity &gt; 1&quot;</span>).UpdateColumn(<span class="hljs-string">&quot;quantity&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;quantity - ?&quot;</span>, <span class="hljs-number">1</span>))<br><span class="hljs-comment">// UPDATE &quot;products&quot; SET &quot;quantity&quot; = quantity - 1 WHERE &quot;id&quot; = 3 AND quantity &gt; 1;</span><br></code></pre></td></tr></table></figure>
<h3 id="2）根据子查询进行更新"><a href="#2）根据子查询进行更新" class="headerlink" title="2）根据子查询进行更新"></a>2）根据子查询进行更新</h3><p>使用子查询更新表</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Model(&amp;user).Update(<span class="hljs-string">&quot;company_name&quot;</span>, db.Model(&amp;Company&#123;&#125;).Select(<span class="hljs-string">&quot;name&quot;</span>).Where(<span class="hljs-string">&quot;companies.id = users.company_id&quot;</span>))<br><span class="hljs-comment">// UPDATE &quot;users&quot; SET &quot;company_name&quot; = (SELECT name FROM companies WHERE companies.id = users.company_id);</span><br><br>db.Table(<span class="hljs-string">&quot;users as u&quot;</span>).Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Update(<span class="hljs-string">&quot;company_name&quot;</span>, db.Table(<span class="hljs-string">&quot;companies as c&quot;</span>).Select(<span class="hljs-string">&quot;name&quot;</span>).Where(<span class="hljs-string">&quot;c.id = u.company_id&quot;</span>))<br><br>db.Table(<span class="hljs-string">&quot;users as u&quot;</span>).Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Updates(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;&#125;&#123;<span class="hljs-string">&quot;company_name&quot;</span>: db.Table(<span class="hljs-string">&quot;companies as c&quot;</span>).Select(<span class="hljs-string">&quot;name&quot;</span>).Where(<span class="hljs-string">&quot;c.id = u.company_id&quot;</span>)&#125;)<br></code></pre></td></tr></table></figure>
<h3 id="3）不使用-Hook-和时间追踪"><a href="#3）不使用-Hook-和时间追踪" class="headerlink" title="3）不使用 Hook 和时间追踪"></a>3）不使用 Hook 和时间追踪</h3><p>如果您想在更新时<strong>跳过 Hook 方法</strong>且<strong>不追踪更新时间</strong>，可以使用 <strong>UpdateColumn</strong>、<strong>UpdateColumns</strong>，其用法类似于 <strong>Update</strong>、<strong>Updates</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 更新单个列</span><br>db.Model(&amp;user).UpdateColumn(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;hello&quot;</span>)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;hello&#x27; WHERE id = 111;</span><br><br><span class="hljs-comment">// 更新多个列</span><br>db.Model(&amp;user).UpdateColumns(User&#123;Name: <span class="hljs-string">&quot;hello&quot;</span>, Age: <span class="hljs-number">18</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;hello&#x27;, age=18 WHERE id = 111;</span><br><br><span class="hljs-comment">// 更新选中的列</span><br>db.Model(&amp;user).Select(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>).UpdateColumns(User&#123;Name: <span class="hljs-string">&quot;hello&quot;</span>, Age: <span class="hljs-number">0</span>&#125;)<br><span class="hljs-comment">// UPDATE users SET name=&#x27;hello&#x27;, age=0 WHERE id = 111;</span><br></code></pre></td></tr></table></figure>
<h1 id="四、删除"><a href="#四、删除" class="headerlink" title="四、删除"></a>四、删除</h1><p>GORM里的更新(Delete方法)，也就是数据库删除语句(Delete语句)，可以删除单条记录，删除多条记录，根据主键删除，删除Hook钩子</p>
<h2 id="1、删除单条记录"><a href="#1、删除单条记录" class="headerlink" title="1、删除单条记录"></a>1、删除单条记录</h2><p>删除一条记录时，删除对象需要<strong>指定主键</strong>，否则会触发 <strong>批量 Delete</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Email 的 ID 是 `10`</span><br>db.Delete(&amp;email)<br><span class="hljs-comment">// DELETE from emails where id = 10;</span><br><br><span class="hljs-comment">// 带额外条件的删除</span><br>db.Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Delete(&amp;email)<br><span class="hljs-comment">// DELETE from emails where id = 10 AND name = &quot;linzy&quot;;</span><br></code></pre></td></tr></table></figure>
<h2 id="2、删除多条记录"><a href="#2、删除多条记录" class="headerlink" title="2、删除多条记录"></a>2、删除多条记录</h2><p>如果指定的值不包括主属性，那么 GORM 会执行批量删除，它将删除所有匹配的记录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Where(<span class="hljs-string">&quot;email LIKE ?&quot;</span>, <span class="hljs-string">&quot;%linzy%&quot;</span>).Delete(Email&#123;&#125;)<br><span class="hljs-comment">// DELETE from emails where email LIKE &quot;%linzy%&quot;;</span><br><br>db.Delete(Email&#123;&#125;, <span class="hljs-string">&quot;email LIKE ?&quot;</span>, <span class="hljs-string">&quot;%linzy%&quot;</span>)<br><span class="hljs-comment">//内联 DELETE from emails where email LIKE &quot;%linzy%&quot;;</span><br></code></pre></td></tr></table></figure>
<h3 id="1）阻止全局删除"><a href="#1）阻止全局删除" class="headerlink" title="1）阻止全局删除"></a>1）阻止全局删除</h3><p>如果在没有任何条件的情况下执行批量删除，GORM 不会执行该操作，并返回 <strong>ErrMissingWhereClause</strong> 错误</p>
<p>对此，你必须加一些条件，或者使用原生 SQL，或者启用 <strong>AllowGlobalUpdate</strong> 模式，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Delete(&amp;User&#123;&#125;).Error <span class="hljs-comment">// gorm.ErrMissingWhereClause</span><br><br>db.Where(<span class="hljs-string">&quot;1 = 1&quot;</span>).Delete(&amp;User&#123;&#125;)<br><span class="hljs-comment">// DELETE FROM `users` WHERE 1=1</span><br><br>db.Exec(<span class="hljs-string">&quot;DELETE FROM users&quot;</span>)<br><span class="hljs-comment">// DELETE FROM users</span><br><br>db.Session(&amp;gorm.Session&#123;AllowGlobalUpdate: <span class="hljs-literal">true</span>&#125;).Delete(&amp;User&#123;&#125;)<br><span class="hljs-comment">// DELETE FROM users</span><br></code></pre></td></tr></table></figure>
<h2 id="3、根据主键删除"><a href="#3、根据主键删除" class="headerlink" title="3、根据主键删除"></a>3、根据主键删除</h2><p>GORM 允许通过内联条件指定主键来检索对象，但只支持整型数值，因为 string 可能导致 SQL 注入。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Delete(&amp;User&#123;&#125;, <span class="hljs-number">10</span>)<br><span class="hljs-comment">// DELETE FROM users WHERE id = 10;</span><br><br>db.Delete(&amp;User&#123;&#125;, <span class="hljs-string">&quot;10&quot;</span>)<br><span class="hljs-comment">// DELETE FROM users WHERE id = 10;</span><br><br>db.Delete(&amp;users, []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;)<br><span class="hljs-comment">// DELETE FROM users WHERE id IN (1,2,3);</span><br></code></pre></td></tr></table></figure>
<h2 id="4、删除Hook钩子"><a href="#4、删除Hook钩子" class="headerlink" title="4、删除Hook钩子"></a>4、删除Hook钩子</h2><p>对于删除操作，GORM 支持 <strong>BeforeDelete</strong>、<strong>AfterDelete</strong> Hook，在删除记录时会调用这些方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> BeforeDelete(tx *gorm.DB) (err <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-keyword">if</span> u.Role == <span class="hljs-string">&quot;admin&quot;</span> &#123;<br>        <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;admin user not allowed to delete&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="5、-软删除"><a href="#5、-软删除" class="headerlink" title="5、*软删除"></a>5、*软删除</h2><p>如果您的模型包含了一个 <strong>gorm.deletedat</strong> 字段（<strong>gorm.Model</strong> 已经包含了该字段)，它将自动获得软删除的能力！</p>
<p>拥有软删除能力的模型调用 <strong>Delete</strong> 时，记录不会被从数据库中真正删除。但 GORM 会将 <strong>DeletedAt</strong> 置为当前时间， 并且你不能再通过正常的查询方法找到该记录。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// user 的 ID 是 `111`</span><br>db.Delete(&amp;user)<br><span class="hljs-comment">// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE id = 111;</span><br><br><span class="hljs-comment">// 批量删除</span><br>db.Where(<span class="hljs-string">&quot;age = ?&quot;</span>, <span class="hljs-number">20</span>).Delete(&amp;User&#123;&#125;)<br><span class="hljs-comment">// UPDATE users SET deleted_at=&quot;2013-10-29 10:23&quot; WHERE age = 20;</span><br><br><span class="hljs-comment">// 在查询时会忽略被软删除的记录</span><br>db.Where(<span class="hljs-string">&quot;age = 20&quot;</span>).Find(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果您不想引入 gorm.Model，您也可以这样启用软删除特性：</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>	  ID      <span class="hljs-type">int</span><br>	  Deleted gorm.DeletedAt<br>	  Name    <span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="1）查找被软删除的记录"><a href="#1）查找被软删除的记录" class="headerlink" title="1）查找被软删除的记录"></a>1）查找被软删除的记录</h3><p>您可以使用 Unscoped 找到被软删除的记录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Unscoped().Where(<span class="hljs-string">&quot;age = 20&quot;</span>).Find(&amp;users)<br><span class="hljs-comment">// SELECT * FROM users WHERE age = 20;</span><br></code></pre></td></tr></table></figure>
<h3 id="2）永久删除"><a href="#2）永久删除" class="headerlink" title="2）永久删除"></a>2）永久删除</h3><p>您也可以使用 <strong>Unscoped</strong> 永久删除匹配的记录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Unscoped().Delete(&amp;order)<br><span class="hljs-comment">// DELETE FROM orders WHERE id=10;</span><br></code></pre></td></tr></table></figure>
<h1 id="五、SQL-构建器"><a href="#五、SQL-构建器" class="headerlink" title="五、SQL 构建器"></a>五、SQL 构建器</h1><h2 id="1、原生-SQL"><a href="#1、原生-SQL" class="headerlink" title="1、原生 SQL"></a>1、原生 SQL</h2><ul>
<li>原生查询 SQL 和 <strong>Scan</strong></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Result <span class="hljs-keyword">struct</span> &#123;<br>	ID   <span class="hljs-type">int</span><br>	Name <span class="hljs-type">string</span><br>	Age  <span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-keyword">var</span> result Result<br>	db.Raw(<span class="hljs-string">&quot;SELECT id, name, age FROM users WHERE id = ?&quot;</span>, <span class="hljs-number">3</span>).Scan(&amp;result)<br><br>	<span class="hljs-keyword">var</span> age <span class="hljs-type">int</span><br>	db.Raw(<span class="hljs-string">&quot;select sum(age) from users where role = ?&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>).Scan(&amp;age)<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>Exec 原生 SQL</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Exec(<span class="hljs-string">&quot;DROP TABLE users&quot;</span>)<br>db.Exec(<span class="hljs-string">&quot;UPDATE orders SET shipped_at=? WHERE id IN ?&quot;</span>, time.Now(), []<span class="hljs-type">int64</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;)<br><br><span class="hljs-comment">// Exec SQL 表达式</span><br>db.Exec(<span class="hljs-string">&quot;update users set money=? where name = ?&quot;</span>, gorm.Expr(<span class="hljs-string">&quot;money * ? + ?&quot;</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">1</span>), <span class="hljs-string">&quot;linzy&quot;</span>)<br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong> GORM 允许缓存预编译 SQL 语句来提高性能</p>
</blockquote>
<h2 id="2、命名参数"><a href="#2、命名参数" class="headerlink" title="2、命名参数"></a>2、命名参数</h2><p>GORM 支持 <strong>sql.NamedArg</strong>、<strong>map[string]interface{}{}</strong> 或 <strong>struct</strong> 形式的命名参数，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go">db.Where(<span class="hljs-string">&quot;name1 = @name OR name2 = @name&quot;</span>, sql.Named(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>)).Find(&amp;user)<br><span class="hljs-comment">// SELECT * FROM `users` WHERE name1 = &quot;linzy&quot; OR name2 = &quot;linzy&quot;</span><br><br>db.Where(<span class="hljs-string">&quot;name1 = @name OR name2 = @name&quot;</span>, <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy2&quot;</span>&#125;).First(&amp;result3)<br><span class="hljs-comment">// SELECT * FROM `users` WHERE name1 = &quot;linzy2&quot; OR name2 = &quot;linzy2&quot; ORDER BY `users`.`id` LIMIT 1</span><br><br><span class="hljs-comment">// 原生 SQL 及命名参数</span><br>db.Raw(<span class="hljs-string">&quot;SELECT * FROM users WHERE name1 = @name OR name2 = @name2 OR name3 = @name&quot;</span>,<br>	sql.Named(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzy1&quot;</span>), sql.Named(<span class="hljs-string">&quot;name2&quot;</span>, <span class="hljs-string">&quot;linzy2&quot;</span>)).Find(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE name1 = &quot;linzy1&quot; OR name2 = &quot;linzy2&quot; OR name3 = &quot;linzy1&quot;</span><br><br>db.Exec(<span class="hljs-string">&quot;UPDATE users SET name1 = @name, name2 = @name2, name3 = @name&quot;</span>,<br>	sql.Named(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;linzynew&quot;</span>), sql.Named(<span class="hljs-string">&quot;name2&quot;</span>, <span class="hljs-string">&quot;linzynew2&quot;</span>))<br><span class="hljs-comment">// UPDATE users SET name1 = &quot;linzynew&quot;, name2 = &quot;linzynew2&quot;, name3 = &quot;linzynew&quot;</span><br><br>db.Raw(<span class="hljs-string">&quot;SELECT * FROM users WHERE (name1 = @name AND name3 = @name) AND name2 = @name2&quot;</span>,<br>	<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>&#123;&#125;&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;linzy&quot;</span>, <span class="hljs-string">&quot;name2&quot;</span>: <span class="hljs-string">&quot;linzy2&quot;</span>&#125;).Find(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE (name1 = &quot;linzy&quot; AND name3 = &quot;linzy&quot;) AND name2 = &quot;linzy2&quot;</span><br><br><span class="hljs-keyword">type</span> NamedArgument <span class="hljs-keyword">struct</span> &#123;<br>	Name  <span class="hljs-type">string</span><br>	Name2 <span class="hljs-type">string</span><br>&#125;<br><br>db.Raw(<span class="hljs-string">&quot;SELECT * FROM users WHERE (name1 = @Name AND name3 = @Name) AND name2 = @Name2&quot;</span>,<br>	NamedArgument&#123;Name: <span class="hljs-string">&quot;linzy&quot;</span>, Name2: <span class="hljs-string">&quot;linzy2&quot;</span>&#125;).Find(&amp;user)<br><span class="hljs-comment">// SELECT * FROM users WHERE (name1 = &quot;linzy&quot; AND name3 = &quot;linzy&quot;) AND name2 = &quot;linzy2&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="3、DryRun-模式"><a href="#3、DryRun-模式" class="headerlink" title="3、DryRun 模式"></a>3、DryRun 模式</h2><p>在不执行的情况下生成 SQL ，可以用于准备或测试生成的 SQL</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">stmt := db.Session(&amp;Session&#123;DryRun: <span class="hljs-literal">true</span>&#125;).First(&amp;user, <span class="hljs-number">1</span>).Statement<br>stmt.SQL.String() <span class="hljs-comment">//=&gt; SELECT * FROM `users` WHERE `id` = $1 ORDER BY `id`</span><br>stmt.Vars         <span class="hljs-comment">//=&gt; []interface&#123;&#125;&#123;1&#125;</span><br></code></pre></td></tr></table></figure>
<ul>
<li>Row &amp; Rows<br>获取 *sql.Row 结果</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 使用 GORM API 构建 SQL</span><br>row := db.Table(<span class="hljs-string">&quot;users&quot;</span>).Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Select(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>).Row()<br>row.Scan(&amp;name, &amp;age)<br><br><span class="hljs-comment">// 使用原生 SQL</span><br>row := db.Raw(<span class="hljs-string">&quot;select name, age, email from users where name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Row()<br>row.Scan(&amp;name, &amp;age, &amp;email)<br></code></pre></td></tr></table></figure>
<ul>
<li>获取 *sql.Rows 结果</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 使用 GORM API 构建 SQL</span><br>rows, err := db.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Select(<span class="hljs-string">&quot;name, age, email&quot;</span>).Rows()<br><span class="hljs-keyword">defer</span> rows.Close()<br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>	rows.Scan(&amp;name, &amp;age, &amp;email)<br><br>	<span class="hljs-comment">// 业务逻辑...</span><br>&#125;<br><br><span class="hljs-comment">// 原生 SQL</span><br>rows, err := db.Raw(<span class="hljs-string">&quot;select name, age, email from users where name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Rows()<br><span class="hljs-keyword">defer</span> rows.Close()<br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>	rows.Scan(&amp;name, &amp;age, &amp;email)<br><br>	<span class="hljs-comment">// 业务逻辑...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>转到 <strong>FindInBatches</strong> 获取如何在批量中查询和处理记录的信息， 转到 Group 条件 获取如何构建复杂 SQL 查询的信息</p>
<h2 id="4、将-sql-Rows-扫描至-model"><a href="#4、将-sql-Rows-扫描至-model" class="headerlink" title="4、将 sql.Rows 扫描至 model"></a>4、将 sql.Rows 扫描至 model</h2><p>使用 <strong>ScanRows</strong> 将一行记录扫描至 struct，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">rows, err := db.Model(&amp;User&#123;&#125;).Where(<span class="hljs-string">&quot;name = ?&quot;</span>, <span class="hljs-string">&quot;linzy&quot;</span>).Select(<span class="hljs-string">&quot;name, age, email&quot;</span>).Rows() <span class="hljs-comment">// (*sql.Rows, error)</span><br><span class="hljs-keyword">defer</span> rows.Close()<br><br><span class="hljs-keyword">var</span> user User<br><span class="hljs-keyword">for</span> rows.Next() &#123;<br>	<span class="hljs-comment">// ScanRows 将一行扫描至 user</span><br>	db.ScanRows(rows, &amp;user)<br><br>	<span class="hljs-comment">// 业务逻辑...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>参考GORM中文文档:<a target="_blank" rel="noopener" href="https://learnku.com/docs/gorm/v2/connecting_to_the_database/9731#64cea3">https://learnku.com/docs/gorm/v2/connecting_to_the_database&#x2F;9731#64cea3</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Gorm/" class="category-chain-item">Gorm</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%AD%A6%E4%B9%A0/">#学习</a>
      
        <a href="/tags/go/">#go</a>
      
        <a href="/tags/mysql/">#mysql</a>
      
        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">#数据库</a>
      
        <a href="/tags/Gorm/">#Gorm</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Gorm学习（二）基础：CRUD接口(数据库增删改查操作)</div>
      <div>https://gopherlinzy.github.io/2022/10/11/gorm_CRUD/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>孙禄毅</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年10月11日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/10/11/gorm-migrate/" title="Gorm学习（三）基础：迁移(数据库建表以及字段设置)">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Gorm学习（三）基础：迁移(数据库建表以及字段设置)</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/11/gorm_begin/" title="Gorm学习（一）入门：Gorm入门指南">
                        <span class="hidden-mobile">Gorm学习（一）入门：Gorm入门指南</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script>
        Fluid.utils.loadComments('#disqus_thread', function() {
          Fluid.utils.createCssLink('https://lib.baomitu.com/disqusjs/1.3.0/disqusjs.css');
          Fluid.utils.createScript('https://lib.baomitu.com/disqusjs/1.3.0/disqus.js', function() {
            new DisqusJS({
              shortname: 'fluid',
              apikey: 'lKZkXbgTsaxCdz8YOZgTixOGwesisQm4K65yWmNk8Nxdc61b6Tjj1xFEWayjMC7a'
            });
          });
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/Gopherlinzy/Gopherlinzy.github.io" target="_blank" rel="nofollow noopener"><span>Github</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
